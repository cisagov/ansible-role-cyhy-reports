---
dist: xenial
language: python
python: 3.7
# pre-commit hooks can use Docker, so we should go ahead and enable it
services: docker

env:
  global:
    - AWS_DEFAULT_REGION="us-east-1"
    # AWS_ACCESS_KEY_ID
    - secure: "FyCCy2dr9ADJglk9tDIgJx7Vg0kxSLL/5KWY03RrGeCZsgXBu7lX2zK\
      ju4pKdnRVzdHZIANLODki6f4vxKa6qZ5lESNnCQRRsGRpSwJoflajOeWTEN3Nw8U\
      CVXno7JM+Fl7iIDoGYX8T6G3IJxTVt4bDry/xEfZTr6sPGqNwKaAz0z3RMmip/i+\
      lKyiCO2LOCZbqT1AA+IdMtvEEfJ+pcs8Zl5YLn2+d+JedDEJ7TlQKGD9CyGxwmBx\
      Xw8tSMH9yWD1PaWnTpdzrxe4jbrNVe58DCdgZEDgYZGTtlyHIVhwzIBSS3kA2su6\
      DQzpWNF/CqKegxZ9hQghL+cn2StCGMe4Ai5npuLrGDCdq8jvH4703nvUzlQQFjlu\
      57Evguy87NYottV6lPl4EVVPPbhdCQPgaHSkKrchMLIPQcBVIM1RuV7uay9ssQLw\
      ynsdLSSwGqDkanAUv5fvBSDf8h0EzqadGlxdEmg6xn3ImFmMCnSIRzdJUctZRRII\
      xxISWXItRdKSqfX0577F6V0/zPuay1YmGjtpFDjPL0A15SdDBDdtQGxpxjtWujeM\
      7Ujt/7oztgGN631C7O87+jIVRXITwuKUKfJH6hlT4+GljJoQC5+ctXA91xEwQFl+\
      zcJIz7LhPTkvlFiXKUd5hZixZHwGSNT4EUst0ugsjupZ8rmaVUOw="
    # AWS_SECRET_ACCESS_KEY
    - secure: "hX5zyzYPEmzbsPGPZWQoAY0hBKtOuRIGDv5N2DSef84Q4gF3k6KgvP2\
      vpxHkwQ/2jQmqxqIXa3f1XVq/PwRNTAvAKlj16yyTpm/iz5OH13lT7B5IS05WsIh\
      uboDv3VjfCHQ9//Vf1dX/Q2fohH31aqwuJ+CQjzBlujoIbNCCxd7yo1GDZkfOUGR\
      f27v/T+tGpA/+Ik4nqA+Y+pldjopkuOLKP7qU2Or3kZgimOt268KCk/xpJvWZwuo\
      vwcQMu4FcFuLUJ4v79CByGslxzyGh71FZ9RCMXEvQk5s50FwaqzqscQ5Inpib70g\
      ObEy4iBhUSrR8+j71a+afog9dXYSwCcYvT6tQlKaJp9WZWe1t8Bzlc73+S3nb9T9\
      Ou8IqWbaAcx5gvSfLGgjxyAY7Y0JwMh4ftzf6S1muAVi43eVt/mJRC022CrDy75F\
      YSppQ8czop8iWKh2Qy80Rqc9pEHQQcCFuepmPv/LqdzcCZFSG+hjmuKogUoHOxyS\
      TfxeWwLoYNKqMetbhYthipwb2Erlca4RkyuxECUSSkQPT1mJl7/gztymfSdLPPPT\
      H2mP5OX3ooeYDs8I9hb8kStCiXNcvUUFK7J9D/MuZzQ3lePOb14VHWtL0N4P7QLS\
      KeeZGNxLN8yhqj3mWc56tEYcWnba9shKRt32NtL/5EaZPmJtVseE="

# Install terraform and terraform-doc
before_install:
  - >
    wget
    https://releases.hashicorp.com/terraform/0.12.3/terraform_0.12.3_linux_amd64.zip
    -O terraform.zip
  - sudo unzip terraform.zip -d /opt/terraform
  - sudo ln -s /opt/terraform/terraform /usr/bin/terraform
  - rm -f terraform.zip
  - go get github.com/segmentio/terraform-docs

# Cache pip packages and pre-commit plugins to speed up builds
cache:
  pip: true
  directories:
    - $HOME/.cache/pre-commit

install:
  - pip install --upgrade -r requirements-test.txt

script:
  - pre-commit run --all-files
  - molecule test
